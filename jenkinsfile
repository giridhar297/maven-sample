pipeline { 
    agent any  
    tools {
        maven 'Maven'
	jdk 'JAVA_HOME'
	sonar 'sonar_scan'
    }
    stages { 

        stage('Initialize') { 
            steps { 
		sh '''
               echo "PATH=${PATH}"
	       echo "M2_HOME=${M2_HOME}"
	       ''' 
            }
	}
        stage('Build') { 
            steps { 
               sh 'mvn -f my-app/pom.xml -Dmaven.test.failure.ignore=true install'
            }
	
        }
	 stage('Results') {
	       steps { 
             junit '**/target/surefire-reports/TEST-*.xml'
              //archive 'target/*.jar'
	}
   }	
  	stage('Analysis'){
	    steps{
        sonar.host.url=http://10.5.2.45:9000/sonar/
	sonar.projectKey=sample_pipeline
	sonar.projectName=sample_pipeline
	sonar.login=admin
	sonar.password=admin
	sonar.projectVersion=1.0
	sonar.sources=my-app/src
	sonar.language=java
	sonar.sourceEncoding=UTF-8
	sonar.java.binaries=my-app/target/classes/com/mycompany/app
	}
       }
  }
}