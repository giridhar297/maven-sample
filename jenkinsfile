pipeline { 
    agent any  
    tools {
        maven 'Maven'
	jdk 'JAVA_HOME'
	sonar 'sonar_scan'
    }
    stages { 

        stage('Initialize') { 
            steps { 
		sh '''
               echo "PATH=${PATH}"
	       echo "M2_HOME=${M2_HOME}"
	       ''' 
            }
	}
        stage('Build') { 
            steps { 
               sh 'mvn -f my-app/pom.xml -Dmaven.test.failure.ignore=true install'
            }
	
        }
	 stage('Results') {
	       steps { 
             junit '**/target/surefire-reports/TEST-*.xml'
              //archive 'target/*.jar'
	}
   }	
	stage('SonarQube analysis') {
	   steps{
        withSonarQubeEnv('sonar_scan') {
      // requires SonarQube Scanner for Maven 3.2+
      sh 'mvn org.sonarsource.scanner.maven:sonar-maven-plugin:sonar'
    }
  }
  }	
  }
}